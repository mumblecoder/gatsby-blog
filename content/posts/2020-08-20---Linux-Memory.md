---
title: 리눅스 메모리 관리
date: "2020-08-20T12:28:42.112Z"
template: "post"
draft: false
slug: "linux-memory"
category: "Daily"
tags:
  - "Linux"
description: "리눅스가 메인 메모리(RAM)를 운영하는 방법에 대해 알아보자"
---

### 메모리란
- 넓은 의미로는 기억 장치 전부, 좁은 의미로는 메인 메모리(RAM)
- 컴퓨터에서 메모리는 유일한 작업 공간.
- 프로세스는 CPU에서 바로 계산할 수 없고 반드시 메모리에 적재한 후에 실행할 수 있다.

### 리눅스 메모리 관리란
- 작업공간을 필요로 하는 프로세스들을 위해 운영체제인 리눅스가 메인 메모리를 관리하고 운영하는 방법

### 메모리 오버레이
- 프로세스의 크기보다 할당받은 메모리의 크기가 작다면? 
- 프로그램의 크기가 실제 메모리보다 클때 전체 프로그램을 메모리에 가져오는 대신 적당한 크기로 잘라서 가져오는 기법을 메모리 오버레이라고 한다.

### 가상 메모리
- 리눅스에서는 보조메모리로 하드디스크나 SSD같은 보조기억장치를 사용한다.
- 실제 디스크를 마치 메모리처럼 사용하는 것을 가상 메모리라고 하며 프로세스 입장에서는 디스크 공간이 아닌 실제 메모리를 인식한다.

### 페이지
- 가상 메모리 시스템에서 메모리를 다룰 때 사용하는 최소 크기 단위, 리눅스에서는 4KB 단위를 사용한다. 쉽게 말해 메모리 한조각을 의미한다.

### 스왑아웃
- 메인 메모리의 프로세스에서 일정 페이지를 잘라서 가상메모리로 가져가는것
### 스왑인
- 가상 메모리에 옮겨 두었던 프로세스의 페이지를 다시 메인 메모리로 가져오는 것


### 가상메모리와 성능
- 성능 관점에서 보면 가상 메모리를 사용하면 가상 메모리와 메모리를 스왑하는 비용때문에 큰 성능 저하가 발생한다.
- 스와핑이 발생하지 않도록 메모리 여유분을 유지하는것이 성능에 중요하다.
- 실무로 배우는 시스템 성능 최적화 책에서는 안정적 운영을 위한 메모리 판단기준을 1. 메모리 사용률 100% 이하, 2. 지속적으로 스오바 아웃이 발생하면 메모리 부족

### 리눅스 명령어 - vmstat
- free : 사용 가능한 메모리양을 의미, 0이되면 메모리 부족을 의미
- so : 스왑 아웃을 뜻함, 지속적으로 증가하면 메모리 부족을 의미
- vmstat [딜레이] [횟수] : 딜레이 간격으로 횟수만큼 출력
- swpd : 사용하고 있는 가상 메모리의 양

### 파일 캐시
- 파일I/O 작업은 메모리보다 속도가 느린 디스크의 리소스를 사용하는 작업이여서 많이 발생하면 성능이 저하된다.
- 이를 개선하기 위해 리눅스에서는 한 번 읽은 파일의 내용을 메모리에 캐시해 두었다가 사용한다.
 > 이것이 buff, cache의 정체
- buff : 파일 시스템의 메타 데이터와 관련된 블록들을 저장하고 있는 캐시
- cache : 파일의 내용을 저장하고 있는 캐시
- WAS서버의 경우 파일 캐시에 의한 성능 개선 사례는 지금까지 경험한적이 없다
- 때문에 파일 캐시는 전체 메모리 대비 최대 크기를 30%이하로 유지하는것을 권고
- DB서버의 경우 DB는 파일 캐시를 내부적으로 해서 메모리에 파일캐시는 필요없다고 한다. 그러므로 DB서버도 파일 캐시의 크기를 작게한다.

### 정리
- 메모리 오버레이란 할당 받은 메모리보다 큰 프로세스를 실행시키기 위해 프로세스의 크기를 일정량 잘라서 메모리에 적재하는 방법
- 가상 메모리란 메모리 오버레이시 남은 프로세스를 디스크에 저장하는 방법이다. 이때 프로세스는 디스크에 올라간 부분을 디스크가 아닌 실제 메모리로 인식한다.
- 페이지는 가상 메모리의 최소 크기 단위이며, 메인 메모리에서 가상 메모리로 가져가는 것을 스왑아웃, 가상메모리에서 메인 메모리로 가져오는 것을 스왑인이라고 한다.
- 메모리 모니터링은 vmstat 명령어로 간단히 수행 가능
- 메모리 사용륭이 100퍼센트이거나, 지속적인 스왑 아웃이 발생하면 메모리가 부족해 서버의 성능에 영향을 끼친다.
- 리눅스의 메모리는 추가적으로 파일 캐시에 대한 정보도 저장한다.


Reference - [그니의 리눅스 메모리 관리](https://youtu.be/OPdjLaW0flU)
