---
title: New IO (NIO)
date: "2020-10-25T21:58:24.829Z"
template: "post"
draft: false
slug: "java-nio"
category: "Daily"
tags:
  - "Java"
description: "Java 1.4부터 새로 나온 New IO (NIO)에 대해 알아보자"
---

### NIO 
- 자바 4부터 새로운 입출력(New Input Output)이라는 뜻에서 java.nio 패키지에 포함되었다.
- 자바 7로 버전업하면서 자바 IO 와 NIO 사이의 일관성 없는 클래스 설계를 바로 잡고 비동기 채널 등의 네트워크 지원을 대폭 강화한 NIO.2 API가 추가되었다.
- NIO2는 java.nio의 하위 패키지(java.nio.channels, java.nio.charset, java.nio.file)에 통합되어 있다.


### IO와 NIO의 차이점
|구분|IO|NIO|
|---|---|---|
|입출력 방식|스트림 방식|채널 방식|
|버퍼 방식|넌버퍼|버퍼|
|비동기 방식|지원 안 함|지원| 
|블로킹/넌블로킹 방식　 　 　 |블로킹 방식만 지원　 　 　 |모두 지원　 　 　 |


1. 스트림과 채널
    - IO는 스트림 기반이다. 스트림은 입력 스트림과 출력 스트림이 구분되어 있다. 데이터를 읽기 위해 입력 스트림을, 출력하기 위해 출력 스트림을 생성 해야한다.
    - NIO는 채널 기반이다. 채널은 스트림과는 다르게 양방향 입출력이 가능해서 입력과 출력을 위한 별도의 채널을 만들 필요가 없다.

2. 넌버퍼와 버퍼
    - IO에서는 출력 스트림이 1바이트를 쓰면 입력 스트림이 1바이트를 읽기 때문에 대체로 느리다.
    - 버퍼를 사용하여 복수 개의 바이트를 한꺼번에 입력받고 출력하는 것이 좋다. 그래서 IO는 버퍼를 제공해주는 보조 스트림인 BufferedInputStream, BufferedOutputStream을 연결해서 사용하기도 한다.
    - IO는 스트림에서 읽은 데이터를 즉시 처리하므로 스트림으로부터 입력된 전체 데이터를 별도로 저장하지 않으면 입력된 데이터의 위치를 이동해 가며 자유롭게 이용할 수 없다.
    - NIO는 기본적으로 버퍼를 사용하여 입출력을 하기 때문에 IO보다 성능이 좋다. 채널은 버퍼에 저장된 데이터를 출력하고 입력된 데이터를 버퍼에 저장한다.
    - NIO는 읽은 데이터를 무조건 버퍼에 저장하기 때문에 데이터의 위치를 이동해 가며 필요한 부분만 읽고 쓸 수 있다.

3. 블로킹과 넌블로킹
    - IO는 블로킹됨. 입력 스트림의 read()를 호출하면 데이터가 입력되기 전까지 스레드는 블로킹(대기상태)되고 출력 스트림의 write()를 호출하면 데이터 출력 전까지 스레드는 블로킹된다.
    - IO스레드가 블로킹되면 다른 일을 할 수 없고 블로킹을 빠져나오기 위해 인터럽트할 수도 없다. 유일한 방법은 스트림을 닫는 것이다.
    - NIO는 블로킹과 넌블로킹 특징을 모두 가진다. NIO 블로킹은 스레드를 인터럽트함으로써 빠져나올 수 있다.
    - NIO 넌블로킹은 입출력 작업 준비가 완료된 채널만 선택해서 작업 스레드가 처리하므로 작업 스레드가 블로킹되지 않는다.
    - NIO 넌블로킹의 핵심 객체는 멀티플렉서인 셀렉터(Selector)이다. 셀렉터는 복수 개의 채널 중에서 준비 완료된 채널을 선택하는 방법을 제공한다.


### NIO의 키워드 3가지. 버퍼, 채널, 셀렉터
1. 버퍼 (NIO에서 제공하는 Buffer클래스)
    - 커널에 의해 관리되는 시스템 메모리를 직접 사용할 수 있는 Buffer 클래스

2. 채널 (Channel)
    - 스트림은 읽기, 쓰기 하나씩 쓸 수 있는 단방향식 이지만, 채널은 읽기, 쓰기 둘 다 가능한 양방향식 입출력 클래스이다.
    - 네이티브 IO , Scatter/Gather 구현으로 효율적인 IO처리가 가능하다. (시스템 콜 수 줄이기, 모아서 처리하기)

3. 셀렉터 (Selector)
    - 네트워크 프로그래밍의 효율을 높이기 위한 것
    - 클라이언트 하나당 쓰레드 하나를 생성해서 처리하기 때문에 쓰레드가 많이 생성될 수록 급격한 성능 저하를 가졌던 단점을 개선하는 Reactor패턴의 구현체



<hr>

> Reference
- [IO와 NIO의 차이점](https://m.blog.naver.com/PostView.nhn?blogId=rain483&logNo=220636709530&proxyReferer=https:%2F%2Fwww.google.com%2F)
- [기본기를 쌓는 정아마추어 코딩블로그](https://jeong-pro.tistory.com/145)

